get_partial_extract <- function(my_query, entities) {
  
  #runjs("console.log('handle_long_extract part 0')")
  print(my_query)
  #runjs("console.log('handle_long_extract part 1')")
  #my_query2 <- "34257155 34381732 34478639 34890276 34478639 34907918 21164044 32039007 20508200 24280772 28196513 24507759 22490780 28513999 21697458 21188461 33191545 26950237 26499398 31178859 29262323 26935289 27221966 27273849 26868913 28031477 22981536 24952504 29466759 34359844 20595650 19689743 32524751 32434457 24816404 32691408 29363526 35222361 23825232 32411122 35174225 28158426 26825554 31941367 32811295 30775441 31704966 31043745 32427863 31160207 32589830 28416795 20727130 32456225 32988843 29669944 32321113 33529160 31181324 31030361 31451099 29785656 30504842 34638757 31649677 31906243 33306983 19380816 26826241 19941314 28417112 29123954 33897370 29956819 34203451 32000895 22025564 29211299 17603493 24907113 19572148 28108766 31557313 34739715 20028852 32903466 16186186 19201693 15313928 17023580 28978469 25771792 30684003 24259296 27558327 27050283 33160842 25616107 34590328 25544757 30482226 31078776 22043967 33711331 34858398 34066647 29426702 29410668 31327964 33052221 28602351 33352944 33198789 31416451 33836143 22937006 34884842 33337366 31824510 32592865 28723550 24885259 28070266 27466354 24825127 32331368 32941599 31257985 33915751 33746988 33919154 31092713 31754705 32155954 29079455 30129188 26125102 32772131 31754025 27241241 20439745 19925669 19818098 26451323 33202783 28580927 21753152 25955018 30455381 29399399 35197103 32453761 26980746 29748013 25941621 26635802 28487310 32209603 25931994 30107552 24942685 33466682 27243593 31963519 26080709 33359089 32652144 30927978 32942172 34633041 35371619 28712928 35082159 33537747 31572379 29324769 25490065 27664279 26838049 19371737 26215868 19429472 24052949 34301813 21106641 21190185 22733995 27487182 19667062 33414787 30622307 24657523 35046083 28541408 32103293 32092078 23589610 27391078 30012671 26982806 26626346 30408584 32621844 27567245 34990621 30392911 33790898 30455703 30487795 32510170 29967068 31755523 34262760 32793228 27999744 25996397 34620838 34413168 28718445 34230649 26647392 31293583 28417112 28638730 30121453 26475869 33906865 34348160 27102489 29241546 35003081 26970376 30262472 29147615 28264904 24501019 25620698 19732719 24092389 35269405 34680231 30003321 22348096 34974960 31957112 29851227 31160207 26619320 33046971 26319316 29904979 29490633 33285051 27609109 24957319 30895168 21685373 33239427 33963274 32508825 31616408 33919875 33741967 25274726 33283987 34140316 27783948 27037906 26348470 23202296 32493990 34620838 33446416 33848267 31611651 26967390 15551798 32045384 32453713 27529074 31546668 34578386 29904979 33542131"
    
  #Get all pmids. Might be useless here TODO
  res <- get_pubmed_ids(my_query)
  
  test <- paste("https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esearch.fcgi?",
                "db=pubmed&&term=", res$OriginalQuery, "&usehistory=n&retmax=100000", sep = "")
  
  res_url <- url(test,open="rb", encoding = "UTF8")
  on.exit(close(res_url))
  idXML <- readLines(res_url, warn = FALSE, encoding = "UTF8")
  collect_ids <- list()
  for (i in 1:length(idXML)) {
    if (grepl("^(\\t){0,1}<Id>", idXML[i])) {
      xx <- custom_grep(idXML[i], tag = "Id", format = "char")
      collect_ids[[length(collect_ids) + 1]] <- as.character(xx[1])
    }
  }
  myIDlist <- as.character(do.call(c, collect_ids))
  print(length(myIDlist))
  
  
  #Connect and get from extract db
  con <- dbConnect(RMySQL::MySQL(), dbname = "extract", user="theodos", password="89Lilu#1")
  
  #Check which entity types are required by the user
  if (length(entities)>0 && "0>" %in% entities) {
    editedEntities <- entities[ !entities == "0>"]
    print(length(editedEntities))
    #Check if there are other entities
    if (length(editedEntities)>0) {
      allData <- dbGetQuery(conn = con, paste("SELECT * FROM EntityWords WHERE pmid IN (",toString(myIDlist),") AND (entityType>0 OR entityType IN (",toString(editedEntities),"))"))
    }else{
      allData <- dbGetQuery(conn = con, paste("SELECT * FROM EntityWords WHERE pmid IN (",toString(myIDlist),") AND entityType>0"))
    }
    #allData <- dbGetQuery(conn = con, paste("SELECT * FROM EntityWords WHERE pmid IN (",toString(myIDlist),") AND (entityType>0 OR entityType IN (",toString(entities),"))"))
    
  }else if (length(entities)>0) {
    allData <- dbGetQuery(conn = con, paste("SELECT * FROM EntityWords WHERE pmid IN (",toString(myIDlist),") AND entityType IN (",toString(entities),")"))
  }else{
    allData <- dbGetQuery(conn = con, paste("SELECT * FROM EntityWords WHERE pmid IN (",toString(myIDlist),")"))
  }
  
  #df <- dbGetQuery(conn = con, paste("SELECT * FROM EntityWords WHERE pmid IN (",toString(myIDlist),")")) %>% group_by(PMID) %>% summarize(Type=paste(EntityType, collapse="."), New=paste(Word, collapse="."),  Id=paste(ID, collapse=".")) %>% rename(pmid=PMID)
  #allData <- dbGetQuery(conn = con, paste("SELECT * FROM EntityWords WHERE pmid IN (",toString(myIDlist),")"))
  #allData <- dbGetQuery(conn = con, paste("SELECT * FROM EntityWords WHERE pmid IN ('21565215 23518347 22277903 31629410 25035953 25035950 12354377 35364740 30483809 29482836 32161718 34566965 31849950 19383967 16527895 11200064 29176984 35133977 31947581 32498431 31300030 28428369 33545035 19320568 27909056 28122869 27922067 27905985 34331874 32723919 23269793 35396971 29703719 29478771 29478771 32461350 32943450 32461350 34442004 32294293 29895501 31333653 28825141 32857321 30476564 19341823 27841856 34381461 16322748 20193028 27869795 23974993 23873152 25479725 31646402 22861366 30400975 27620506 33729699 23352235 29959183 17446082 33473192 16818757 31063541 30584238 26717325 33526926 28297581 26610284 32138314 11927927 32414695 30569204 23460749 19936055 32907925 35048638 25931043 12553699 21413455 16720036 27546361 34248984 33759145 34788598 23686490 20570887 33361391 34960815 21442393 34445367 34579743 32246014 29033131 30930171 28923935 29950315 26573801 31727856 27525438 33836585 27197074 27357636 25008481 33054050 33672737 29437577 15919883 29261815 30542349 34773892 27421871 33813036 28273887 24963213 28263993 33037057 23273921 31718550 32230977 33051339 31312042 27243595 32693188 34343272 27130484 35177618 34134627 33566377 31061532 9389474 22005520 20303596 19922425 32599709 26671426 31497026 27851925 33014656 31713700 31372765 26764486 28432199 28050750 29515586 10879693 31290914 27213956 31209404 31409426 33296655 28556560 22178414 28586276 32117255 28865088 31333642 24166242 17869134 32810438 31754025 32157175 31456804 33015602 35372996 33183319 31501122 34659254 30649988 30357490 33293219 32071090 31474513 31472079 28930664 25033907 28774715  21214520 30842629 31089324 30760015 29069365 32841051 21153665 21888931 20133793 23296408 19301037 26538820 34140953 34206393 34440315 34827560 35204748 31090259 33717163 35300986 34279540 34965966 30641038 25901897 34860431 22777876 35401514 35406483 29750788 33767694 35185880 24626392 26484769 28835242 29906450 32610077 30953118 29504948 35089436 32979832 31184711 25962123 35000202 30179225 33607496 31474513 28783692 30996346 29348500 30323345 31467405 34135508 34239777 27888810 29961579 28143882 31365858 32783915 21943488 30827862 34965415 6862689 31903134 35241835 20424161 34637400 11777962 32269279 17114237 17545580 22685580 29988129 87267 6765335 24612598 35325594 24220244 31178859 29616851 22786767 28677265 32733446 35181780 6971808 16556895 33266104 15879104 27976373 33641866 28837503 26718149 27446090 22268650 15905489 22041852 26069306 17429444 30530726 27194625 29466759 25481369 23332516 25107306 32209459 30528823 29180488 28592561 28958578 33492309 34672126 23143594 33888321 34303522 34000757 34903717 32282893 32763266 33135636 31221993 35199642 31086329 34233045 30518920 33805777 31786670 31473081 34514433 34299338 34524838 34312415 33425431 33815385 34282331 33098771 28916263 26109679 26198639 35279880 31024570 25545227 31616403 22542839 25279834 31242422 34887574 19609975 34257155 34381732 34478639 34890276 34478639 34907918 21164044 32039007 20508200 24280772 28196513 24507759 22490780 28513999 21697458 21188461 33191545 26950237 26499398 31178859 29262323 26935289 27221966 27273849 26868913 28031477 22981536 24952504 29466759 34359844 20595650 19689743 32524751 32434457 24816404 32691408 29363526 35222361 23825232 32411122 35174225 28158426 26825554 31941367 32811295 30775441 31704966 31043745 32427863 31160207 32589830 28416795 20727130 32456225 32988843 29669944 32321113 33529160 31181324 31030361 31451099 29785656 30504842 34638757 31649677 31906243 33306983 19380816 26826241 19941314 28417112 29123954 33897370 29956819 34203451 32000895 22025564 29211299 17603493 24907113 19572148 28108766 31557313 34739715 20028852 32903466 16186186 19201693 15313928 17023580 28978469 25771792 30684003 24259296 27558327 27050283 33160842 25616107 34590328 25544757 30482226 31078776 22043967 33711331 34858398 34066647 29426702 29410668 31327964 33052221 28602351 33352944 33198789 31416451 33836143 22937006 34884842 33337366 31824510 32592865 28723550 24885259 28070266 27466354 24825127 32331368 32941599 31257985 33915751 33746988 33919154 31092713 31754705 32155954 29079455 30129188 26125102 32772131 31754025 27241241 20439745 19925669 19818098 26451323 33202783 28580927 21753152 25955018 30455381 29399399 35197103 32453761 26980746 29748013 25941621 26635802 28487310 32209603 25931994 30107552 24942685 33466682 27243593 31963519 26080709 33359089 32652144 30927978 32942172 34633041 35371619 28712928 35082159 33537747 31572379 29324769 25490065 27664279 26838049 19371737 26215868 19429472 24052949 34301813 21106641 21190185 22733995 27487182 19667062 33414787 30622307 24657523 35046083 28541408 32103293 32092078 23589610 27391078 30012671 26982806 26626346 30408584 32621844 27567245 34990621 30392911 33790898 30455703 30487795 32510170 29967068 31755523 34262760 32793228 27999744 25996397 34620838 34413168 28718445 34230649 26647392 31293583 28417112 28638730 30121453 26475869 33906865 34348160 27102489 29241546 35003081 26970376 30262472 29147615 28264904 24501019 25620698 19732719 24092389 35269405 34680231 30003321 22348096 34974960 31957112 29851227 31160207 26619320 33046971 26319316 29904979 29490633 33285051 27609109 24957319 30895168 21685373 33239427 33963274 32508825 31616408 33919875 33741967 25274726 33283987 34140316 27783948 27037906 26348470 23202296 32493990 34620838 33446416 33848267 31611651 26967390 15551798 32045384 32453713 27529074 31546668 34578386 29904979 33542131')"))
  
  return(allData)
}

get_extract_data <- function(my_query, entities, maxArticles=10000) {
  
  
  #print(is.numeric(my_query))
  #splittedQuery <- strsplit(my_query, " +")
  
  maxDocs = maxArticles
  
  #print(my_query)
  #my_query<-paste(my_query, "1:2019[dp]", sep = " ")
  
  #Get all pmids
  res <- get_pubmed_ids(my_query)
  print("Work")
  
  test <- paste("https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esearch.fcgi?",
                "db=pubmed&&term=", res$OriginalQuery, "&usehistory=n&retmax=",maxDocs, sep = "")
  
  res_url <- url(test,open="rb", encoding = "UTF8")
  on.exit(close(res_url))
  idXML <- readLines(res_url, warn = FALSE, encoding = "UTF8")
  collect_ids <- list()
  for (i in 1:length(idXML)) {
    if (grepl("^(\\t){0,1}<Id>", idXML[i])) {
      xx <- custom_grep(idXML[i], tag = "Id", format = "char")
      collect_ids[[length(collect_ids) + 1]] <- as.character(xx[1])
    }
  }
  myIDlist <- as.character(do.call(c, collect_ids))
  
  
  #Connect and get from extract db
  con <- dbConnect(RMySQL::MySQL(), dbname = "extract_2023", user="theodos", password="89Lilu#1")
  #df <- dbGetQuery(conn = con, paste("SELECT * FROM EntityWords WHERE pmid IN (",toString(myIDlist),")")) %>% group_by(PMID) %>% summarize(Type=paste(EntityType, collapse="."), New=paste(Word, collapse="."),  Id=paste(ID, collapse=".")) %>% rename(pmid=PMID)
  
  #Check which entity types are required by the user
  if (length(entities)>0 && "0>" %in% entities) {
    editedEntities <- entities[ !entities == "0>"]
    print(length(editedEntities))
    #Check if there are other entities
    if (length(editedEntities)>0) {
      allData <- dbGetQuery(conn = con, paste("SELECT * FROM EntityWords WHERE pmid IN (",toString(myIDlist),") AND (entityType>0 OR entityType IN (",toString(editedEntities),"))"))
    }else{
      allData <- dbGetQuery(conn = con, paste("SELECT * FROM EntityWords WHERE pmid IN (",toString(myIDlist),") AND entityType>0"))
    }
    #allData <- dbGetQuery(conn = con, paste("SELECT * FROM EntityWords WHERE pmid IN (",toString(myIDlist),") AND (entityType>0 OR entityType IN (",toString(entities),"))"))
    
  }else if (length(entities)>0) {
    allData <- dbGetQuery(conn = con, paste("SELECT * FROM EntityWords WHERE pmid IN (",toString(myIDlist),") AND entityType IN (",toString(entities),")"))
  }else{
    allData <- dbGetQuery(conn = con, paste("SELECT * FROM EntityWords WHERE pmid IN (",toString(myIDlist),")"))
  }
  #allData <- dbGetQuery(conn = con, paste("SELECT * FROM EntityWords WHERE pmid IN (",toString(myIDlist),") AND entityType IN (",toString(entities),")"))
  #print(colnames(allData))
  
  #Get Word-Type
  wordTypeIDTable <- allData[, c('Word', 'EntityType', 'Ext_db_id')]
  #print(wordTypeIDTable)
  
  #Format allData for clusternig etc
  df <- allData %>% group_by(PMID) %>% summarize(Type=paste(EntityType, collapse="."), New=paste(Word, collapse="."),  Id=paste(ID, collapse=".")) %>% rename(pmid=PMID)
  #print(nrow(df))

  
  #Get one column df$columnName
  #extract_corpus <- corpus(df, text_field='New', docid_field = 'pmid')
  extract_corpus <- corpus(df, text_field='New', docid_field = 'pmid')
  corpus_tokens <- extract_corpus %>% tokenize_regex(pattern = "\\.")
  articles_dfm <- dfm(tokens(corpus_tokens))
  #articles_dfm <- dfm(extract_corpus)
  #print('Articles dfm')
  #print(articles_dfm)
  #print(colSums(articles_dfm))
  
  #Change column names for term- frequency table
  sumVec <- colSums(articles_dfm)
  termFreq <- data.table::as.data.table(sumVec, keep.rownames = TRUE)
  colnames(termFreq) <- c('Term', 'Frequency')
  
  results <- list()
  #results$articles_corpus <- articles_corpus
  #results$corpus_tokens <- corpus_tokens
  results$articles_dfm <- articles_dfm
  results$term_frequency <- termFreq
  results$wordTypeIDTb <- wordTypeIDTable
  results$untokenizedExtract <- df
  
  return(results)
}
get_long_extract_data <- function(long_dataSet) {
  
  #runjs("console.log('handle_long_extract part 2')")
  #Get Word-Type
  wordTypeTable <- long_dataSet[, c('Word', 'EntityType')]
  #print(wordTypeTable)
  
  #runjs("console.log('handle_long_extract part 2.1')")
  
  #Format allData for clusternig etc
  df <- long_dataSet %>% group_by(PMID) %>% summarize(Type=paste(EntityType, collapse="."), New=paste(Word, collapse="."),  Id=paste(ID, collapse=".")) %>% rename(pmid=PMID)
  #print(df)
  
  #runjs("console.log('handle_long_extract part 2.2')")
  
  #Get one column df$columnName
  #extract_corpus <- corpus(df, text_field='New', docid_field = 'pmid')
  extract_corpus <- corpus(df, text_field='New', docid_field = 'pmid')
  corpus_tokens <- extract_corpus %>% tokenize_regex(pattern = "\\.")
  articles_dfm <- dfm(tokens(corpus_tokens))
  #articles_dfm <- dfm(extract_corpus)
  #print('Articles dfm')
  #print(articles_dfm)
  #print(colSums(articles_dfm))
  
  #runjs("console.log('handle_long_extract part 2.3')")
  
  #runjs("console.log('Called 5')")
  
  results <- list()
  #results$articles_corpus <- articles_corpus
  #results$corpus_tokens <- corpus_tokens
  results$articles_dfm <- articles_dfm
  results$term_frequency <- colSums(articles_dfm)
  results$wordTypeTb <- wordTypeTable
  
  return(results)
  
}

get_pubmed_data <- function(query, remote=FALSE) {
  
  if(remote) {
    #Get the pubmed ids for the query
    pmids <- get_pubmed_ids(query)
    
    # Retrieve pubmed data in XML format given the PMIDs
    pubmed_data_xml <- easyPubMed::fetch_pubmed_data(pmids)
    
    # Store Pubmed Records as elements of a list
    all_xml <- easyPubMed::articles_to_list(pubmed_data_xml)
    
    # convert xml PubMed documents to data frame
    df_of_articles <- do.call(rbind, lapply(all_xml, easyPubMed::article_to_df, 
                                            max_chars = -1, getAuthors = FALSE))
  }
  # retrieve from local repository
  else {
    pubmedDB = mongo(collection="articles", db="pubmed2", url="mongodb://172.17.0.1")
    #runjs("console.log('localPub 1')")
    
    print("get_pubmed_data")
    print(query)
    pmids<-entrez_search(db="pubmed", term = query, retmax=10000)$ids
    print(pmids)
    #pmids<-as.character(pmids)
    #runjs("console.log('localPub 2')")
    #print(pmids)
    
    #query <- paste('{"pmid": { "$in":[',pmids,']}}',sep = "")#{pmid: { $in: ['A', 'D']}}
    query <- '{"pmid": { "$in": ['
    idStr<-paste("\"",pmids[1],"\"",sep="")
    for (id in pmids[2:length(pmids)]) {
      idStr <- paste(idStr, ", \"", id, "\"", sep="")
    }
    query <- paste(query, idStr, ']}}', sep="")
    #query <- '{"pmid": { "$in": ["25448298", "25100685", "23866856"]}}'
    print(query)
    localRes <- pubmedDB$find(query)
    #runjs("console.log('localPub 3')")
    years<-(localRes$pubdate)
    #print(names(localRes))
    #localResultsDf <- as.data.frame(localRes)
    #print(localResultsDf)
    
    allDocs <-data.frame(matrix(ncol = 4, nrow = length(localRes$pmid)))
    columnNames <- c("pmid", "year", "title", "abstract")
    colnames(allDocs) <- columnNames
    
    allDocs$pmid<-localRes$pmid
    allDocs$year<-years
    allDocs$title<-localRes$title
    allDocs$abstract<-localRes$abstract
    
    #runjs("console.log('localPub 4')")
    
    df_of_articles <- allDocs
    #print(df_of_articles)
    #runjs("console.log('localPub 5')")
  }
  
  return(df_of_articles)
}


my_quert3.1 <- "37709651 38037248 38321168 38716809 37321346 38783142 38355776 38582079 37696660 38641661 38762837 38801963 38785980 38102460 38752931 37978868 38775785 38361280 38521197 38225393 38527697 38812313 38492843 38763302 38000700 37356803 38456640 38776742 38797129 38387504 38353580 38422972 38309690 38554788 38180017 38514017 38450435 37728583 38649144 38174587 37938186 38795644 38753870 38604293 38376850 38714664 38041584 38702325 38593971 38447147 38354756 38583854 38695990 38519771 38740758 38678560 38702808 37927089 38293807 38735936 38579893 38522484 38782909 38583651 38786047 38776677 38812059 38788598 38050963 38417972 37977448 38752369 38790149 38513593 38364328 38733657 38739691 37914905 38483947 38728007 38523127 38677281 38552295 38531220 38158714 38565010 38491202 38649614 38499285 38163960 38009729 38843684 37897408 38626543 38712979 38724256 38703969 38745499 38882284 38763774 38891049 38419188 37964627 38769281 38764773 38748778 38431406 38868764 38577949 38266949 38636937 38792546 38755164 38757920 38621452 38715546 38713437 38373380 38522500 38439187 38795560 38704111 38579899 38781635 38593619 38583338 38711615 38286157 38749344 38823748 38761422 38643552 38815668 38308641 38738543 38734148 38163952 38697462 38791141 38835772 37611898 38609772 38789796 37999993 38347131 38789434 38460907 38761376 38806964 38800967 38764033 38700005 38423240 37739213 38740222 38696256 38320630 38115546 38574620 38424148 38714719 38807081 38626849 38359963 38417894 37516120 37906274 38745155 38575082 38704513 38522525 38563966 38811901 38764054 38552443 37992314 38599914 38260951 38791423 38580181 38760513 38408589 38759936 38891847 38763008 38772149 38781849 38710260 38735276 37878043 38679250 38664338 38775843 38806451 38741166 38729544 38718107 37800867 38720397 38591880 38627586 38436694 38692058 38778209 38891873 38698024 38782303 38479440 38316218 38729284 38153175 38758815 38816685 38863700 38705039 38554601 38809648 37897664 38745204 38693589 38488519 38767677 38289512 38462123 38574829 38728287 38772922 38719825 38656870 38565942 38745316 38701988 38604309 38796484 38522660 38788268 38754535 38581905 38772951 38679413 38801405 38788395 38508529 38804615 38503100 38796662 37838331 38777823 38324746 38555817 38711131 38530586 38171600 38718656 38755206 38657629 38728286 37908143 38738304 38238641 38776847 38599056 38779685 38727063 38271051 38763444 38636283 38806137 38812314 38518089 38717639 38378874 38508245 38734811 38237377 38789509 38891879 38820631 38791438 38760841 38556959 38373797 38781865 38718624 38768701 37942668 38845506 38720350 38466463 38655617 38758395 38725370 38752883 38588586 38653091 38781731 38780316 38423213 38807213 38686653 38759937 38013411 38817444 38730535 38759291 38516774 38716985 38791463 38748517 38699808 38810485 38508115 38728949 38696874 38786030 38712963 38810283 38720283 38763373 38521250 38648079 38331014 38788367 38646170 38762919 38579616 38701207 38810288 38760351 38783387 38499157 38783087 38786033 38224943 38773376 38720012 38593938 38709216 38552739 38578697 38758159 38742793 38462227 38820902 38761255 38720340"
my_quert3.2 <-"38807192 37974331 38779103 38697845 38008361 38720472 38772740 38710459 38771157 38808891 38615642 38776609 38774923 38719025 38812175 38597274 38708789 38740228 38879332 38537110 38556155 38744191 38699807 38776784 38760678 38816263 38791178 38536415 38408588 38517018 38755221 38797732 38703919 38786094 38796213 38798253 38095212 38513524 38693792 38506349 38728252 38769308 38662199 38518853 38812570 38678672 38602220 38815772 38698047 38613601 38759931 38652007 38892077 38759847 38766486 38359670 38654519 38579892 38772299 38797260 38814215 38579922 38713951 38508437 38789954 38776987 38820739 38787367 38736295 38705218 38759815 38735590 38527647 38521196 38594897 38763964 38813617 38734222 38670181 38293799 38710377 38735623 38786619 38808888 38683122 38799643 38631218 38892575 38722704 38648921 38579709 37814779 37897053 38581954 38722865 38438032 38759738 38797842 38705399 38749116 38608998 38683127 38764025 37735930 37339721 38680105 38526939 38772138 38565807 38810818 38640929 38797855 38636999 38626609 38242315 38639485 38324130 38759453 38805997 38583855 38661655 38591363 38807157 38744379 38739631 38636258 38522588 38556061 38760019 38815059 38776757 38730324 37906389 38580410 38593507 38786060 38754538 38171601 38717096 38750718 38518724 38670500 38271626 38780299 38490521 38720392 38531523 38891822 38786097 38729336 38768545 38812004 38796918 38810305 38477444 38778344 38360363 38497110 38784395 38759629 38785143 38833788 38710382 38705344 38447978 38798258 38782946 38693258 38809522 38724533 38548152 38445453 38769658 38703975 38759835 38806484 38802814 38772757 38745240 38818468 38772366 38776285 38697460 38629837 38707383 38750694 38854107 38782255 38779726 38799254 38292187 38754428 38755257 38815686 38883358 38821165 38744666 38745449 38758521 38827527 38761210 38764180 38783947 38766767 37862221 38810696 38704587 38799573 38766825 38812421 38719780 38752371 38799145 38761015 38719085 38827477 38762760 38799627 38796312 38699926 38840894 38705394 38854023 38699021 38800357 38766171 38823674 38828290 38762757 38867714 38817333 38761287 38803139 38720731 38760886 38827476 38777145 38833958 38758520 38727882 38628660 38826627 38807299 38734903 38741381 38891277 38694127 38855162 38009708 38791701 38782098 37862211 38807430 38703943 38762116 38760822 38800594 38762750 38780897 38811718 38814780 38808635 38728182 38717958 38854113 38740701 38757275 38766333 38780752 38821252 38735055 38789662 38771358 38707926 38882274 38849220 38697775 38801738 38763209 38775879 38775007 38533432 38812563 38706859 38725147 38863498 38762759 38826216 38783335 38705724 38744436 38774969 38778919 38707329 38803355 38777993 38754818 38747700 38800376 38627949 38726124 38310990 38872838 38815669 38691300 38808280 38748043 38859931 38747016 38841374 38804899 38758516 38700951 38814784 38696652 38855739 38833786 38788061 38735913 38224485 38815737 38395181 38712859 38782722 38736558 38769089 38886960 38778750 38827171 38758472 38860169 38801155 38726830 38726368"
my_quert3.3 <-"38725195 38771412 38808395 38763173 38703341 38222900 38701220 38577812 36604792 38721972 38882370 38794196 38783939 38577924 38492612 38708805 38743191 38700877 38510527 38815862 38776555 38719150 38761508 38786250 38827524 38460493 38807666 38686458 38756797 37862179 38801925 38863929 38744264 38897197 38713838 38810653 38859837 38851099 38717633 38695174 38468368 38646175 38812137 38767338 38886933 37862201 38799762 38774504 38690847 38783090 38725137 38802071 38797393 38766427 38704365 38412240 38742307 38786704 38735787 38708799 38690008 38709265 37862184 38828396 38521619 38769906 38779712 38758187 38551159 38569377 38803357 38728425 38682702 38762094 38723719 38281809 38798445 38743588 38787424 38695993 38883313 38891243 38628627 38761632 38742852 38484587 38821350 38761804 38582337 38870615 38521622 38743320 38446070 38311340 38702921 38787146 38706230 38840923 38723459 38817073 38710696 38802657 38471283 38496548 37526673 38726504 38713439 38439203 38798261 38809352 38814067 38696266 38400630 38654453 38115557 38797597 38516767 38715081 38729031 38716779 38353127 38762749 38691250 38802839 38636651 38747479 38636369 38753171 38417589 38726147 38802351 38652960 38785527 38720546 37862200 38873415 38798203 38811508 38798921 38713535 38768831 38750415 37946006 38521728 38723438 38779758 38698322 38801393 38411312 38891915 38780644 38699532 38286832 38868372 38813109 38706843 38799985 38701508 38740235 38821173 38753465 38745059 37745492 38873225 38696438 38799235 38715128 38704503 38769548 38702806 38760408 38718909 38688134 38715049 38685209 38726865 38588809 38783959 38512553 38626848 38492921 38412575 38724504 38761081 38802993 38790673 38784556 38696003 38779488 38734832 38374468 38859833 38823393 38790068 38728749 38746191 38883377 38766075 38743565 38462040 38760620 38727789 38729223 38804152 38768108 38729485 38721827 38518600 38882290 38721679 38570272 38883131 38831954 38781025 38458501 38755413 38741190 38799423 38816926 38816880 38783956 38722530 38486054 38875923 38828457 38794206 38760473 38696056 38552976 38863748 38803690 38757364 38499237 38784801 38763184 38760482 38755466 38700837 38744890 38808598 38736291 38720356 38719197 38706097 38626659 38761423 38488029 38789030 38785562 38774081 38768687 38746182 38696728 38445883 38851043 38810287 38767306 38696653 38522818 38493916 38295847 38758439 38761779 38688626 38725082 38565059 38803433 38791308 38729051 38696909 38307028 38744472 38736322 38734147 38548341 37670201 38692860 38805503 38768083 38762529 38761883 38741034 38740617 38736325 38732200 38701343 38569428 38430661 38812379 38803224 38779751 38764125 38751776 38697643 38696276 38518838 38815952 38788596 38750332 38781831 38768953 38699959 38441365 38367792 38790723 38781292 38744174 38497119 38433718 38893392 38750263 38744938 38720136 38716300 38697767 38624096 38429891 38287209 38187609 38000017 37996696 37977441 38846008 38827158 38790979 38735333 38718259 38447582 38814440 37922063 37665410 38795886 38881941 38193334 38802941 38741149 38503214 38806135 38777148 38740259 38705417 38554538 38401834 38785155 38778409 38518631"
my_quert3.4 <-"38084791 38779590 38650478 38779872 38778562 38652869 38513802 38759300 38734249 38704789 38696589 38573013 38289723 38795641 38730018 38715063 38626424 38695539 38799458 38772877 38704112 38336181 38798711 38726817 38700244 38458369 38795753 38734265 38725414 38734119 38552292 38789798 38776806 38750985 38556103 38802459 38772286 38740102 38730456 38583856 38727048 38591878 38811988 38763341 38452695 38766663 38753057 38557354 38508231 38744219 38727803 38582394 38778385 38738428 38720063 38740779 38779674 38794195 38759404 38778379 38750771 38771937 38517332 38704764 38583241 38376926 38711119 38587552 32532970 32011236 31857374 31625269 30952864 30642888 30568238 30026233 29867141 29700228 29251248 28712572 26765567 26415220 26347139 25503391 25490467 24949430 24535825 24204963 23209807 22948227 22643220 22267086 22138575 21893048 21317376 21189453 20639194 20562859 20100911 20010802 19619494 19363302 17580304 32170063 31914609 31908024 31783609 30990354 30804553 29593293 29539270 29446751 29416008 29277967 28598235 28395732 28291748 28287329 27561680 27458016 27402840 27375021 26687600 26451915 26040720 25931115 25684205 25224329 24668264 24569479 24528869 24485455 23530606 22982544 22505714 22421968 20083108 32681145 32460019 31740503 30902965 30806153 30773365 30767700 30109811 29937374 29297744 29233873 29137209 28806134 28655748 28404643 28121222 28038982 27880899 27540684 27551434 27439889 27129200 27071037 26929408 25896323 25498145 25127057 24914561 24563201 24290141 24265594 23878278 23562278 23530068 23022382 21670587 21383079 20615880 19322194 19250911 19021777 32620754 32009292 31006537 30979895 30936319 30740539 30451685 29717061 29290589 29255173 29109477 29097655 28617241 28470758 28399398 28381481 28244873 28100687 27791457 27749824 27246247 27028858 26903539 26698918 26468287 26431026 26146385 26040717 25215947 25042851 24589857 24067654 23908376 23736261 23209295 23043107 22354992 21620860 21606687 20639871 18027972"
my_query2 <- "34257155 34381732 34478639 34890276 34478639 34907918 21164044 32039007 20508200 24280772 28196513 24507759 22490780 28513999 21697458 21188461 33191545 26950237 26499398 31178859 29262323 26935289 27221966 27273849 26868913 28031477 22981536 24952504 29466759 34359844 20595650 19689743 32524751 32434457 24816404 32691408 29363526 35222361 23825232 32411122 35174225 28158426 26825554 31941367 32811295 30775441 31704966 31043745 32427863 31160207 32589830 28416795 20727130 32456225 32988843 29669944 32321113 33529160 31181324 31030361 31451099 29785656 30504842 34638757 31649677 31906243 33306983 19380816 26826241 19941314 28417112 29123954 33897370 29956819 34203451 32000895 22025564 29211299 17603493 24907113 19572148 28108766 31557313 34739715 20028852 32903466 16186186 19201693 15313928 17023580 28978469 25771792 30684003 24259296 27558327 27050283 33160842 25616107 34590328 25544757 30482226 31078776 22043967 33711331 34858398 34066647 29426702 29410668 31327964 33052221 28602351 33352944 33198789 31416451 33836143 22937006 34884842 33337366 31824510 32592865 28723550 24885259 28070266 27466354 24825127 32331368 32941599 31257985 33915751 33746988 33919154 31092713 31754705 32155954 29079455 30129188 26125102 32772131 31754025 27241241 20439745 19925669 19818098 26451323 33202783 28580927 21753152 25955018 30455381 29399399 35197103 32453761 26980746 29748013 25941621 26635802 28487310 32209603 25931994 30107552 24942685 33466682 27243593 31963519 26080709 33359089 32652144 30927978 32942172 34633041 35371619 28712928 35082159 33537747 31572379 29324769 25490065 27664279 26838049 19371737 26215868 19429472 24052949 34301813 21106641 21190185 22733995 27487182 19667062 33414787 30622307 24657523 35046083 28541408 32103293 32092078 23589610 27391078 30012671 26982806 26626346 30408584 32621844 27567245 34990621 30392911 33790898 30455703 30487795 32510170 29967068 31755523 34262760 32793228 27999744 25996397 34620838 34413168 28718445 34230649 26647392 31293583 28417112 28638730 30121453 26475869 33906865 34348160 27102489 29241546 35003081 26970376 30262472 29147615 28264904 24501019 25620698 19732719 24092389 35269405 34680231 30003321 22348096 34974960 31957112 29851227 31160207 26619320 33046971 26319316 29904979 29490633 33285051 27609109 24957319 30895168 21685373 33239427 33963274 32508825 31616408 33919875 33741967 25274726 33283987 34140316 27783948 27037906 26348470 23202296 32493990 34620838 33446416 33848267 31611651 26967390 15551798 32045384 32453713 27529074 31546668 34578386 29904979 33542131"

my_query4.1 <- "16226444 11762070 11152279 893032 18627835 1193137 11089924 12967324 16048838 11169858 16874031 745078 1234402 11489210 12655150 16116281 880627 15197469 12561078 11382752 872203 6796799 12914955 6376111 12047555 14997209 6722559 3467980 12951440 12753924 16002396 454395 1058524 7361547 6892613 7015046 8995210 880619 6088263 16267277 4339922 1383780 406 16200202 10747018 15140920 1193121 9361094 15292400 11413459 11575420 12589435 7737293 15985464 12214070 2700097 9089409 11264288 11416184 15325591 9754330 9412464 4125701 11739566 2582478 7217398 16040659 3337633 7686635 16874062 14997941 14699140 16314482 14699058 1195050 15928708 11716248 10344472 16216920 12095676 2897824 6177140 7448046 1844304 9666231 3160088 3972014 11208145 15361333 12208507 4092819 16111945 15146978 991204 10805342 467859 15834662 12388602 10233149 11100732 6749503 23045041 11382760 15778222 12958363 12387888 9520903 15096203 15258458 10545112 11210735 15340014 951961 8304450 7249095 9880567 14567965 12721289 12372286 14536056 11471499 3921759 15025927 12576632 6108011 7493651 920180 16343609 2184419 7701602 15958487 1789148 16001423 11908071 8568686 14658067 16043512 15680548 670291 2700098 4834889 14988919 126140 3889889 14684378 6178729 16425255 7750517 617355 15905882 15130673 9151316 7388042 1974096 15138286 15680329 8888585 14761979 10611955 6504921 14731737 15449304 12482611 11827521 9305927 16192467 15369603 8860999 4345186 524349 12618311 8910489 6390584 9030745 9600096 12661040 6110267 16039970 2451345 14627652 6339086 1377375 15247238 7324793 915948 15150321 7407413 6488481 4212555 15755735 14613877 1617290 6303895 16185655 15246997 10939967 11856168 12876352 12826404 12917395 15277523 29865450 15103325 16874023 6272504 15209383 3956579 9127730 8617261 15310832 16300744 16019722 830435 537099 9140926 1031520 10704370 15342963 2668454 15246252 2867796 9759715 16217076 16141322 10712513 9483764 7854199 15367582 925081 616696 2708336 1844305 170735 15167929 12364329 15781969 2186664 11596377 11810238 15175258 15796014 14970205 15102438 15620219 11878584 7113544 9096783 16027116 16343880 16209346 1718514 9023185 10362069 6994073 189997 7867570 3316916 3579883 2314391 11445593 6184865 11861300 11707514 10591966 6633696 7437137 5990170 15576571 10357175 11149920 10888236 11131136 14715704 4322760 7449928 8223709 10757644 16376114 11861771 3622631 30103575 12039038 12195297 8603680 8183364 1447423 232106 12872732 15236765 12221124 15725726 6205594 12615333 8548491 9714796 11856375 15040443 9873051 14736886 2122424 233059 14679207 9245783 12473346 10047828 946951 15296715 3036075 15064741 3978124 2458100 15635436 9008702 3961792 11455422 15524167 3288350 927529 15592434 16109995 2444587 6882239 14673167 15978794 6712293 7308488 12180975 4269735 11524438 10436019 11319612 12371905 3599130 16874025 15689486 14711115 16592758 16874072 6840208 15592527 15221529 6105141 6137901 8262162 16027528 5099207 16239905 9295314 16172400 12473658 15689323 16352265 9151652 15833867 15854889 12649263 8741274 15358773 11173534 7759538 16049009 11897782 16903142 1400575 6846502 15196934"
my_query4.2 <-"3117904 510512 6178975 2134264 15325581 2745748 1171105 9886486 3309961 8063774 10972293 5792407 11675395 12672451 616697 3797073 8577312 4779329 10452827 2837607 15375585 15807663 8094926 2626800 12684373 11261546 10700391 15989961 9209504 3023303 3136556 12297099 2700096 3787117 12168801 7890712 15308769 8037 15563611 12700167 11096087 2161853 16192271 7601097 7142520 15138258 7628530 16159344 7511608 16874029 12383798 9852036 3678464 15558033 4209843 14647296 7410819 10675567 14570716 4336064 12512345 7250217 6141661 16280007 7814364 12505983 16103921 3979450 15624019 12628346 11489916 15325592 12105396 9759731 15602573 2369924 789126 9431454 12112116 12915208 183065 12914914 3129869 9761717 16083722 7149477 12787572 10731687 9196056 16533930 14611647 8825067 6686563 11486014 14500369 8861000 15287014 7117273 10406795 15333840 4322718 4292315 16077193 16471263 7120230 12934067 16203860 11850849 7001413 2307216 12915210 3169726 12453151 9690670 2904192 11693989 15894275 7538465 11985575 15028711 15801807 15494556 6489454 11707261 1674461 11076969 7359173 16087747 15699107 16079147 12740822 10549293 6582822 3955637 16007218 1022092 616726 15610520 10673148 3198654 7113543 15538170 15752356 1349776 701378 11756670 12593804 16874047 15911352 9332326 10938088 15187094 7031794 8168547 12874701 11453254 7867640 8885233 1460658 16287853 15271937 15884975 12576635 7214551 16297339 9184851 1482075 15218946 15781609 10218476 15861817 8663915 11059790 78636 3366562 1927279 12600911 16874032 8196708 2238058 9061858 8907731 4793386 12719433 6829308 15326383 15953364 510782 2391370 10844143 2524636 10906274 16874076 11840159 12672448 9366212 15738970 7377986 16148314 3542550 7260116 8513485 11406606 6119837 5084962 7022621 12840538 1844320 14734056 2351689 617549 3678491 15735063 10628833 11583975 14651611 15194695 1118857 11762074 3510885 3898114 16186256 11868368 10837477 11330070 7836465 12731050 16874040 1644523 3922593 11500446 11567883 7682217 1572394 1668895 1560421 3697752 15596714 3323622 15987928 9563500 12934068 1813814 8330626 12519199 6537922 12833855 9046040 8132712 10617575 10425703 15753448 12114572 18631462 15343317 4092821 3194962 3678466 2664591 8980904 6855223 12181736 15670835 14734026 16874042 11770122 12740394 2578110 348541 2942192 11719268 14668412 7354616 10547367 14713959 10837932 8475037 14993595 11262243 1795162 16151633 14511700 15680321 11005224 15068787 11904149 15925308 15907470 4809711 7342606 1419119 16314462 14673145 11709544 12153478 8639161 15379282 10333748 12753650 3967337 15350980 15800333 16416394 8332133 10662773 14662753 6603168 12868068 12807918 7113542 10891486 15607973 11058089 7117271 167989 11983070 3593223 10582243 16300732 1970680 15044841 16247496 9639028 4076173 12408842 11890701 12459473 2379507 12820725 3492868 12096123 11229442 12416391 8743408 12207896 1667279 1618306 12651870 8339038 12702460 15840653 11840166 12153465 1575680 6232647 10233150 10906272 16151638 7238609 12792893 15708857 15090297 10604474 2166050 2806405 15169837 8391468 2282639 12727826 1666282 3017118 12761572 7446224 11266458 13679515 16157655 16091749"
my_query4.3<-"1462768 16869772 16874021 12609989 4359852 12589048 433787 11447261 6432917 121974 16223601 664183 14998927 4363771 6756945 12638132 16159959 11838706 18627848 14533007 3882435 16874049 16230342 14638851 12421624 3046602 16186126 11193023 12417306 4034572 15131264 15104104 6641796 11596386 10894155 12189143 606259 16246023 862791 11162551 16286508 16175394 14662750 3300746 166064 9556549 15994211 553561 16125113 7355988 3194963 9190802 3803535 412933 8152599 15922724 17481329 16099697 10489408 1326577 6685129 11134899 12972570 15461583 15004240 5555045 10476808 12529432 15615727 12503998 11737265 8761415 2656154 6701723 8471030 15701809 7357575 15149326 6609054 4329463 7305895 2484018 11342162 6857247 7400039 5574612 9046588 11872158 15975090 16108220 689091 8821342 3926777 6351780 1915755 11536007 15047874 6851171 8408278 12432101 9660497 6232395 15452145 15525940 6472884 7140848 6292442 16313222 224204 16874024 9010456 15827065 15953030 14657232 3025210 9174669 12702243 9336704 16221887 12941698 1032000 12407797 4091820 6132491 2430955 9398032 10506101 601865 2557642 8451445 10961423 9224892 16148885 11684094 1511694 15615779 2456889 15679103 6169535 15857680 12698196 7218755 15614625 16473626 3941538 6853609 15325590 15813701 10233148 16335232 11075957 12175670 3306875 16874034 14610086 15031729 12771364 7654342 15087496 40832 16270748 15355958 16042544 12428172 11256608 15004330 11725643 8360706 2103895 11825910 3817097 3859913 15781608 12519185 10985743 2995112 7741731 4065288 7401637 10576889 15875542 11427988 15746529 1743994 2267499 15867207 7958356 4350479 15325579 6755063 10329731 12372273 7433233 9201760 15143348 7738102 10735854 1709158 15757483 16365039 15860012 6366364 4034554 6170571 597269 3391236 14985360 3757907 1918014 15178341 11895116 16077961 3310358 16874026 11739804 15325582 15161048 11689437 10893413 16234846 2979616 6816084 15488168 9882627 10406794 9151736 16099218 27520665 15659643 807028 6952238 1904444 8432730 15325588 15277759 11693992 11085977 9362071 15121881 14560952 15325585 11250121 14657158 11175264 4652592 3298935 16002336 16186173 1033139 8126105 11029306 3691671 10507799 616715 7342603 43011 11276319 6134384 15797834 15637642 2857648 10668192 9034581 6143441 10685367 2969728 3579879 11212227 2745747 12576636 12702641 7668398 6099843 1314483 15900708 3888648 12235073 3171166 16247502 12446702 6340116 15325586 15325583 15178086 10496537 7449766 699030 3371064 11241348 11694599 11739783 15894272 10444415 16592499 1950421 3253173 7349531 15147878 4141861 1740188 11382761 10993892 6803221 15648001 15325587 3940229 5780799 15053150 1320371 12628171 9268694 16278443 11511528 10686581 12815463 10393803 962834 12770435 14657337 3930383 16874039 3827846 16247492 7068752 7113546 1127552 12068296 1112667 11872957 8000424 7433243 59722 15928714 16303767 12740821 15003262 7268204 576772 9914830 3020067 12593803 402731 12847175 11139573 15014045 15569246 12665549 14627994 3622627 6330453 12808139 2121295 830012 12885772 11937716 2238797 6530038 2441560 290994 1755265 8613784 15325580 15591165 6115507 1321157"
my_query4.4 <- "15265004 16183633 16213475 1683722 7148726 15146184 15082787 12967556 7721188 12163359 12112433 11528422 12499843 3743649 15715672 1211660 11852075 6366240 15894616 4013853 29969867 12642577 16297550 11309418 15678148 15968549 6966276 729734 7445977 15295079 3983015 1963524 9566964 15632278 12965207 6137107 10966461 9224897 11528006 3989258 1666280 7019210 8267619 11152450 16371244 12088630 16113053 12507496 6337500 11050468 3830106 12455967 3281890 8663607 3593777 6743687 12384310 1913593 2805089 3197795 14705733 15468969 4309985 16408008 15530778 6757457 12446664 9928825 11096062 8813078 12095988 12186856 15879436 206717 12226358 16874035 10681575 2699941 1844306 11980920 8408307 15569245 5707057 12960228 12623230 15168518 15719028 7626015 7516358 2892402 16874036 15459747 15857831 16289106 2103896 3335254 9008703 16339752 7056284 16174725 15016820 2410315 6454071 6245643 12634373 11930000 750710 16077201 12890687 15155809 2675530 791957 11007884 15325584 7825737 15928081 7102239 476810 7166511 15703644 15809734 7117495 12871590 7929229 6116319 4074882 7107581 11675007 14977482 12228341 10322822 12626495 15751225 8165307 16180666 3967280 10508157 1028677 6811136 3886148 11579570 12479808 2350239 2947561 9529893 14623438 16131500 15752076 16570122 16874022 6705927 2319125 10837468 15745979 7418864 16257859 11058096 2559734 15998324 11524437 11052993 954048 3731281 2887061 11478840 5810987 9298250 11171076 11082038 8269618 15752997 6173730 4348785 6721227 16125351 6713242 6840200 6313782 11566994 1318815 15866887 11099404 10856287 11812794 15747063 6211414 9003422 16061648 15869955 15489192 11709589 16002240 8393787 15294772 15168519 14504273 1324248 12070171 16874055 6116336 14706333 8647085 8224160 1666281 3443984 1349775 15984551 9461583 10683585 6202146 15806102 3907302 12507414 10380578 1443117 16055436 10806201 12968056 2980734 15935769 12911744 7253029 8731032 12185842 11552028 10807547 9792918 14723849 10074098 12839986 12194907 8344312 12865942 6210310 16176344 15556634 16247501 8654402 11038174 15272002 10642502 12814436 3785973 24178610 12792883 15384708 15947196 12221139 8682862 2090063 20654355 407706 11533052 24309833 6240602 937509 10702672 15331765 7215561 16874045 2868710 12479807 6133857 3180188 15492808 10862611 12611592 224687 15521560 11703917 2883765 4335746 6325532 8936477 9113411 15077152 12062171 8332052 4002338 10580846 5084963 11477064 12048214 11033860 14655753 9726984 2954539 2700099 10525546 9032450 16326107 6939293 11281288 9649430 7925493 3666090 15947785 15585405 303474 172336 16236257 15745976 8921905 5542737 15743910 9832612 6274200 10713714 16004578 24248572 16120267 15167559 15635090 12381530 11207567 1844321 7151824 12709412 4062082 419967 4415937 3943558 16091357 16465277 421869 6999604 7113640 283412 1247182 9038401 15798367 15787614 4034240 15948631 14684184 1022083 14556717 1547871 16158257 95365 8211945 16228979 1506410 16322256 11265251 16447778 12646047 10983987 10637306 14724107 28305502 12408621 15296710 16874027 3830181 7642298 12228312 12391329 4034551 16029203 233353 6593227 15901835 15130664"
my_query4.5 <-"645821 6382268 7034180 16903144 6829310 4360607 3294826 16024660 757985 3201844 16874052 16334980 4043252 7814324 9407152 15528435 7223232 11330661 19806690 15894271 3215790 6119846 15541471 9214379 3758219 15675366 7351828 10995454 15977643 16247498 14985441 15949434 6234264 15888080 4987365 11146101 3041209 1217071 16054213 6589857 15607905 10717484 12125051 3662603 11853878 15784530 6400516 3579882 616731 1598802 6613582 14615598 15970208 6055998 16210515 16874067 15827380 15456523 15140988 1436948 12464659 15556609 16247495 15749469 7065251 6142562 11369189 7096343 14744787 14530254 1028676 11390663 11435181 11448994 16077200 8223708 1096530 6315357 1270534 11086004 15911750 14722905 6295976 6073998 15528445 7028659 7080797 6655116 6822543 12510379 15727215 6997059 11306555 14554193 9303440 8253727 9990423 3137115 692646 16874038 16247499 14715890 9973603 10982339 11001934 16368705 9309391 2239745 15657430 11060023 11598188 218912 16271306 6297995 7314075 13972975 7706847 10625637 11262416 16179260 15489196 7196802 3402459 9693035 12742529 12941871 7105141 3142967 15899829 12586404 8283401 14559683 8900960 7342604 18620181 827101 12882821 11430817 8191799 2389676 11731258 3126737 7540986 11494315 2885969 12022954 11270572 2982630 11205141 11964142 6834787 11978769 7724523 14513262 11319546 9296392 6183789 156504 2161764 11147495 399892 2619764 16381639 28304536 118624 15205343 7475351 288328 4034548 9883858 8361964 15296714 15647514 11157979 7050533 16846070 6134390 12878159 2646143 10906271 15618468 15883160 15171682 7294153 3636281 3667602 9151668 7326824 16332691 8415593 3932342 8993159 12499386 11559757 15341644 4767257 11693997 15944916 6975223 10769033 2279274 4029346 15325593 3889477 11550068 1801702 12672457 15377997 679267 16214290 15604369 11309306 8993346 8901576 9865607 4650199 11454456 11104685 486112 8794292 12593626 1779240 7405868 7456314 15471899 10470502 9712845 12187785 5223594 12576634 15616545 15578654 12888255 15123735 7260111 15860017 15980862 11676000 6102826 16211491 16325851 616720 12470504 16507409 2980101 16247500 12196656 4336076 3443985"

#final_query <- paste(my_quert3.1, my_quert3.2, my_quert3.3, my_quert3.4)

allPartialLists <- c(my_query4.1, my_query4.2, my_query4.3, my_query4.4, my_query4.5)
allPartialQueries <-paste(my_query4.1, my_query4.2, my_query4.3, my_query4.4, my_query4.5, sep=" ")

#columns= c("ID","PMID","Word","EntityType", "Ext_db_id") 
#totalData = data.frame(matrix(nrow = 0, ncol = length(columns))) 
#df_of_articles <- data.frame(matrix(nrow = 0, ncol = length(columns))) #The column names are wrong, but the number is correct

# assign column names
#colnames(totalData) = columns
#totalData <-data.frame()
combined_data <- list()
list_of_articles <- list()
#columns = c("pmid", "year", "title", "abstract")
#df_of_articles <- data.frame(matrix(nrow = 0, ncol = length(columns)))

for (list in allPartialLists) {
  partialData <- get_extract_data(list, c())
  combined_data <- c(combined_data, partialData)
  
  partialPubmedData <- get_pubmed_data(list, remote=FALSE)
  #df_of_articles <- merge(x = df_of_articles, y = partialPubmedData, all=TRUE)
  #df_of_articles <- c(list_of_articles, partialPubmedData)
  #print(length(partialPubmedData$pmid))
  #list_of_articles <- c(list_of_articles, partialPubmedData)
  list_of_articles <- rbind(list_of_articles,partialPubmedData)
}
#extractResults <- get_long_extract_data
#totalData <- do.call(rbind, combined_data)  # Using rbind

# #Fix combined data
# # Define sublist names
# sublist_names <- c("articles_dfm", "term_frequency", "wordTypeIDTb", "untokenizedExtract")
# 
# comnbined_fixed <- list()
# for (list in combined_data){
#   print(names(list))
#   #if list.name == "articles_dfm"
# }

# Print the final data frame 
print(names(combined_data))
print(length(list_of_articles$pmid))

#The real is not working properly because combined_data is list (and not really combined) while list_of_articles is combined correctly

df_of_articles <- data.frame(pmid = list_of_articles$pmid, year = list_of_articles$year,  title = list_of_articles$title,  abstract = list_of_articles$abstract)
print(length(df_of_articles[,"pmid"]))

get_extract_data(my_query2, c())

killDbConnections <- function () {
  
  all_cons <- dbListConnections(MySQL())
  
  print(all_cons)
  
  for(con in all_cons)
    +  dbDisconnect(con)
  
  print(paste(length(all_cons), " connections killed."))
  
}

killDbConnections()

##SIMULATION##
#query_sim <- c(my_query4.1, my_query4.2, my_query4.3, my_query4.4, my_query4.5)
query_sim <- "21565215 23518347 22277903 31629410 25035953 25035950 12354377 35364740 30483809 29482836 32161718 34566965 31849950 19383967 16527895 11200064 29176984 35133977 31947581 32498431 31300030 28428369 33545035 19320568 27909056 28122869 27922067 27905985 34331874 32723919 23269793 35396971 29703719 29478771 29478771 32461350 32943450 32461350 34442004 32294293 29895501 31333653 28825141 32857321 30476564 19341823 27841856 34381461 16322748 20193028 27869795 23974993 23873152 25479725 31646402 22861366 30400975 27620506 33729699 23352235 29959183 17446082 33473192 16818757 31063541 30584238 26717325 33526926 28297581 26610284 32138314 11927927 32414695 30569204 23460749 19936055 32907925 35048638 25931043 12553699 21413455 16720036 27546361 34248984 33759145 34788598 23686490 20570887 33361391 34960815 21442393 34445367 34579743 32246014 29033131 30930171 28923935 29950315 26573801 31727856 27525438 33836585 27197074 27357636 25008481 33054050 33672737 29437577 15919883 29261815 30542349 34773892 27421871 3381303"
splitted_query <- strsplit(query_sim, " +")
totalWords <- sapply(splitted_query, length)

# observe({
#   if(totalWords<24){
#     showNotification("Not enough papers found. Please reload the page", type="error")
#   }
# })

#If it is too long split it before processing
if (totalWords > 20){
  #if (totalWords < 0){
  
  allSubstrings <- vector()
  for (str in splitted_query) {
    allSubstrings <-append(allSubstrings, str)
  }
  
  wordIdx <- 0
  partialList <- vector()
  allPartialLists <- list()
  for (str in allSubstrings) {
    
    #if (wordIdx<200 || wordIdx > 200) {
    #if (wordIdx<200) {
    if (wordIdx<20) {
      #runjs("console.log('Got here')")
      partialList <- append(partialList, str)
    }else{
      allPartialLists <- append(allPartialLists, list(partialList))
      
      
      partialList <- vector()
      partialList <- append(partialList, str)
      wordIdx <- 0
    }
    wordIdx <- wordIdx+1
  }

  
  #Combine data
  
  #NEW data combination 
  combined_data <- list()
  list_of_articles <- list()
  #columns = c("pmid", "year", "title", "abstract")
  #df_of_articles <- data.frame(matrix(nrow = 0, ncol = length(columns)))
  
  killDbConnections()
  
  for (list in allPartialLists) {
    id_string <- paste(list, collapse = " ")
    print(id_string)
    partialData <- get_extract_data(id_string, c())
    combined_data <- c(combined_data, partialData)
    
    partialPubmedData <- get_pubmed_data(id_string, remote=FALSE)
    #df_of_articles <- merge(x = df_of_articles, y = partialPubmedData, all=TRUE)
    #df_of_articles <- c(list_of_articles, partialPubmedData)
    list_of_articles <- c(list_of_articles, partialPubmedData)
  }
  #extractResults <- get_long_extract_data
  #totalData <- do.call(rbind, combined_data)  # Using rbind
  
  # Print the final data frame 
  #print(combined_data)
  #print(list_of_articles)
  extractResults <- combined_data
  df_of_articles <- data.frame(pmid = list_of_articles$pmid, year = list_of_articles$year,  title = list_of_articles$title,  abstract = list_of_articles$abstract)
  
  
  # #totalData <- data.frame()
  # columns= c("ID","PMID","Word","EntityType") 
  # totalData = data.frame(matrix(nrow = 0, ncol = length(columns))) 
  # df_of_articles <- data.frame(matrix(nrow = 0, ncol = length(columns))) #The column names are wrong, but the number is correct
  # 
  # # assign column names
  # colnames(totalData) = columns
  
  
  #Here it gets different from pubmed to extract
  #         for (list in allPartialLists) {
  #           runjs("console.log('elem in allPartialLists')")
  #           partialData <- get_partial_extract(toString(list), input$entity_types_parameters)
  #           
  #           #This is for the clustered documents of the split and merge
  #           partialIds <- get_pubmed_ids(toString(list))
  #           partialPubmedData <- get_pubmed_data((partialIds), remote=FALSE)
  # 		killDbConnections()
  #           if (nrow(partialData)>100) {
  #             runjs("console.log('partialData > 100')")
  #           }else{
  #             runjs("console.log('partialData < 100')")
  #           }
  #           
  #           totalData <- merge(x = totalData, y = partialData, all = TRUE)
  #           df_of_articles <- merge(x = df_of_articles, y = partialPubmedData, all=TRUE)
  #         }
  #         
  #         if (nrow(totalData)>10) {
  #           runjs("console.log('totalData > 10')")
  #         }else{
  #           runjs("console.log('totalData < 10')")
  #         }
  #         
  #        if ("EntityType" %in% colnames(totalData)){
  #          runjs("console.log('EntityType exists')")
  #        }else{
  #          runjs("console.log('EntityType does not exist')")
  #        }
  #         
  #         runjs("console.log('Long extract part 2')")
  #         
  #         #Get info for wordclouds etc
  #         extractResults <- get_long_extract_data(totalData)
  #         
  #         runjs("console.log('Long extract part 3')")
  
}else{
  print(query_sim)
  extractResults <- get_extract_data(query_sim, c())
  
  #Fetch pubmed data (abstracts etc)
  #my_query <- get_pubmed_ids(query)
  
  # fetch data and save them in a data frame
  df_of_articles <- get_pubmed_data(query_sim)
}